# LyricLingo FSD (Functional Specification Document)

## 1. 개요

**목표:**

외국인 학습자가 K-pop 가사를 기반으로 한국어 표현과 문화를 자연스럽게 학습할 수 있도록 돕는 웹 서비스.

**MVP 범위:**

가사 불러오기 → 문장 분석 → 표현 학습 → 퀴즈/피드백의 4단계 플로우 완결.

## 2. 사용자 시나리오 (MVP 기준)

| 구분 | 설명                                                       |
| ---- | ---------------------------------------------------------- |
| 1    | 사용자가 K-pop 노래를 선택한다.                            |
| 2    | 시스템이 가사를 자동 불러오고, 문장 단위로 분석한다.       |
| 3    | 분석 내용을 바탕으로 문장 5개정도를 추출한다               |
| 4    | 사용자에게 각 문장의 의미, 어휘, 문화적 뉘앙스를 제공한다. |
| 5    | 학습 후 퀴즈를 통해 표현을 복습한다.                       |
| 6    | 사용자 학습 기록이 간단히 저장된다.                        |

## 3. 주요 기능 명세

### 3.1 **가사 로딩 및 노래 선택**

- **기능명:** 노래 선택 및 가사 불러오기
- **설명:** 사용자가 입력하거나 검색한 K-pop 노래의 가사를 API 또는 DB에서 불러옴.
- **세부기능:**
  - 노래 검색창 제공 (제목/가수명 기준)
  - 가사 데이터 요청 (API or 사전 등록 DB)
  - 가사 로드 후 문장 단위 분리
- **예외처리:**
  - API 실패 시 “가사를 불러올 수 없습니다” 메시지 출력

### 3.2 학습할 가사 추출

- **기능명:** 전체 가사 중 일부 문장 추출
- **설명:** 입력된 전체 가사에서 학습 가치(문화적 맥락/표현 학습 가능성)가 높은 문장 5개(기본값)를 자동으로 선별하여 사용자에게 제안
- **세부기능:**
  - 문장 출력 수량 및 규칙
    - 기본 추천 개수: **5개** (옵션: 최대 6개).
    - 최소 허용 추천 개수: **3개**. (추천 문장 수 < 3이면 사용자에게 알리고 수동선택 유도)
    - 우선순위: 문장 학습점수(learningScore) 기준 상위 N개 선택
  - 학습점수(learningScore) 계산(heuristic + AI 보조)
    > 구현 방식 - 초기에 형태소 분석(한국어 토크나이저) + 룰 기반 패턴(밈/축약어 목록)로 전처리하고, 상위 후보를 Claude/GPT에 보내 재평가/정렬
    - 점수는 0~1 범위. 예시 가중치(조정 가능):
      - nonKoreanRatio(한/영/혼합 비율) w1 = 0.20
      - idiomIndicator(숙어/관용어/밈 감지) w2 = 0.30
      - rareWordRatio(저빈도 어휘 비율) w3 = 0.20
      - posComplexity(품사 복잡도: 조사·어미·수식구 비율) w4 = 0.15
      - lengthScore(문장 길이 적정성) w5 = 0.15
    - 산식(예시):
      `learningScore = w1*nonKoreanRatio + w2*idiomIndicator + w3*rareWordRatio + w4*posComplexity + w5*lengthScore`
    - 난이도 레벨 매핑:
      - score ≤ 0.33 → easy
      - 0.34 ≤ score ≤ 0.66 → medium
      - score > 0.66 → hard
  - 예외/팝업 UX
    - 추천 문장 수 < 3: 팝업 "`학습에 적합한 문장이 충분하지 않습니다. (현재 추천 X개). 계속 진행하시겠습니까?`"
      - 버튼: [계속 진행] (최대 2단계: 진행), [직접 선택] (가사 전체에서 수동 선택 UI로 이동)
    - 사용자가 직접 선택 가능: 전체 가사 뷰에 체크박스 표시, 다중 선택(최대 6) 후 확정.
  - 캐싱/비용
    - 결과는 `songs/{songId}/extractions`로 Firestore 캐싱. 동일 songId 요청 시 캐시 우선 반환.
    - 캐시 TTL: 30일(초기 설정). 필요 시 조정.

### 3.3 **가사 분석 (언어 + 문화)**

- **기능명:** 문장 단위 의미 분석
- **설명:** 각 문장에 대해 언어적 의미 + 문화적 뉘앙스를 제공
- **세부기능:**
  - **구현(AI)?**
  - 형태소 분석 기반 단어 추출
  - ChatGPT API를 통해 문장별 요약 및 표현 설명
  - 어려운 표현에 대한 “쉬운 버전” 병기
- **출력 형식:**
  - 원문 / 의미 / 표현 설명 / 문화적 해석 순서로 표시
- **제한:**
  - 한 문장당 최대 3개 표현만 분석 (MVP 범위)

### 3.4 **학습 화면 구성**

- **기능명:** 문장 기반 학습 뷰
- **설명:** 각 문장을 슬라이드 형식으로 넘기며 학습 가능
- **세부기능:**
  - 기본 원칙
    - **모바일 우선**. 사용자는 주로 휴대폰에서 가볍게 학습.
    - 단계적 노출(Progressive disclosure): 처음엔 가사 라인(간단) → 카드 클릭시 상세 내용 노출.
    - 상호작용을 통해 단순 소비를 학습 행위로 전환.
  - 레이아웃 & 네비게이션 (권장: 카드 캐러셀 + 리스트 보기)
    - 기본 뷰: **캐러셀(수평 swipe)** — 한 번에 한 문장 카드(Front) 표시.
      - 이유: 모바일에서 직관적, 집중 유지, 순차적 학습 흐름에 적합.
    - 보조 뷰: **연속 스크롤 리스트** (데스크톱/접근성용). 토글 버튼으로 전환 가능.
  - 카드 구성 (Front / Back)
    - **Front (카드 앞면)**:
      - 원문 가사(강조 표시), 재생 버튼(해당 구절 오디오 5~8초), 난이도 아이콘(점/색), progress indicator (e.g., 2/5).
      - 액션 버튼: [학습하기] (뒤집기/확장), [하트] 저장, [더보기] 상세 모달.
    - **Back (카드 뒷면) — 학습 콘텐츠**:
      - Literal translation (직역)
      - Natural translation (의역 / 자연스러운 표현)
      - Cultural context (문화적 배경 / 밈 / 은유 해석)
      - Example usage(s) (2 문장)
      - Related expression (비슷한 영어 표현)
      - Tip (사용시 주의점)
      - 액션: [퀴즈로 복습], [예문 더보기], [저장/공유(미구현)]
    - 카드 뒤로는 스크롤 가능(내용 길 때).
  - 동작 흐름(사용자 상호작용)
    1. 캐러셀에서 카드(Front) 표시.
    2. 사용자가 [학습하기] 누르면 카드 Flip 애니메이션 → Back 내용 노출.
    3. Back에서 [퀴즈로 복습] 클릭 시 퀴즈 모달(또는 페이지)로 이동.
    4. [하트] 클릭 시 Firestore 또는 로컬 스토리지에 저장(비로그인 MVP는 로컬 우선, Firestore sync optional).
    5. 좌/우 스와이프 또는 [다음]/[이전] 버튼으로 다음 카드로 이동.
    6. 전체 카드 리스트 보기(아이콘 클릭)로 전환 가능.
  - UI 상태/피드백
    - AI 생성 지연 시: 스켈레톤 카드 + "AI로 학습카드를 생성 중입니다..." 텍스트.
    - AI 실패 시: "간단 번역(기본) 제공" + "다시 시도" 버튼.
    - 저장 성공 시: 애니메이션(작은 체크) + 토스트 "저장됨".
  - 접근성/입력
    - 키보드 내비게이션: ←/→로 카드 이동, Enter로 뒤집기.
    - 스크린리더: 카드의 앞/뒤 콘텐츠에 ARIA 레이블 제공.
  - **데이터저장:** 즐겨찾기/최근 학습 문장 로컬 스토리지에 저장

### 3.5 **표현 복습 퀴즈**

- **기능명:** 표현 퀴즈
- **설명:** 학습한 표현 중 일부를 랜덤으로 출제하여 의미 맞추기
- **세부기능:**
  - 3지선다 or OX 형태 (랜덤)
  - 정답 시 즉시 피드백 제공
  - 5문항 기준 (한 세션)
  - 결과 요약: 정답률 표시
- **데이터저장:** 세션별 정답률 로컬 저장

### 3.6 **학습 리포트 (요약형)**

- **기능명:** 간단한 학습 리포트
- **설명:** 최근 학습 노래/표현/퀴즈 결과를 표시
- **세부기능:**
  - 최근 학습한 노래 목록 (최대 5개)
  - 누적 학습 표현 수
  - 퀴즈 평균 점수
- **데이터저장:** 로컬 스토리지 기반

## 4. 관리자 기능 (MVP 제외)

> MVP에서는 미포함. 향후 확장 시 고려

- 사용자 로그인/회원관리
- 통계 대시보드
- 가사 DB 관리

## 5. 기술 스택 (제안)

| 구분        | 기술                                |
| ----------- | ----------------------------------- |
| 프론트엔드  | Next.js + TypeScript + Tailwind CSS |
| 백엔드(API) | Node.js (Express) + OpenAI API      |
| DB          | Firebase / Supabase (MVP는 선택적)  |
| 배포        | Vercel                              |

## 6. MVP 범위 내 제외 기능

| 제외 기능              | 이유                        |
| ---------------------- | --------------------------- |
| 사용자 로그인/회원가입 | 초기엔 로컬 스토리지로 대체 |
| SNS 공유 기능          | 핵심 플로우에 비핵심        |
| 사용자 커뮤니티/댓글   | 복잡도 증가                 |
| 다국어 UI              | MVP는 영어 고정             |
| AI 발음 분석           | 학습 난이도 과도            |

## 7. 품질 기준

| 항목             | 기준                          |
| ---------------- | ----------------------------- |
| 응답속도         | 3초 이내                      |
| API 실패율       | 5% 이하                       |
| 학습 세션 지속성 | 브라우저 종료 후 1주일 유지   |
| UI 반응성        | 모바일/데스크톱 대응 (반응형) |

## 8. 릴리즈 기준 (MVP 완료 조건)

- 사용자가 노래를 검색하여 가사를 불러올 수 있음
- 각 문장별 의미·표현·해석을 학습 가능
- 퀴즈를 풀고 정답률을 확인 가능
- 로컬 스토리지 기반으로 학습 기록이 유지됨
